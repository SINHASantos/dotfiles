#!/usr/bin/env ruby

require "pp"

def parse_args
  args = ARGV

  if args == []
    STDERR.puts <<-EOS
Usage:
  replace STRING_TO_REPLACE STRING_TO_REPLACE_WITH GLOB_PATTERN

Example:
  replace "NewCardModel" "Card" "**/*.rb"
    EOS
    exit 1
  end

  {
    old: args[0],
    new: args[1],
    glob: args[2],
  }
end

args = parse_args

glob = args.fetch(:glob)
new = args.fetch(:new)
old = args.fetch(:old)

files = Dir.glob(glob).select do |file|
  File.read(file).force_encoding("UTF-8") =~ /\b#{old}\b/
end

files.each do |file|
  puts "Updating #{file}"
  new_contents = File.read(file).force_encoding("UTF-8").gsub(/\b#{old}\b/, new)
  File.write file, new_contents
end
