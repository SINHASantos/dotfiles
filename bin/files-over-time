#!/bin/bash

set -e

file_type=$1

revisions() {
  git rev-list master --reverse | awk 'NR % 10 == 0'
}

trim_leading_white_space() {
  sed 's/ *//'
}

files() {
  find . -name $file_type
}

count() {
  wc -l | trim_leading_white_space
}

main() {
  for rev in `revisions`
  do
    git checkout -q $rev
    count=`files | count`
    if [ $count == 0 ]; then
      graph=' '
    else
      graph=`jot -b '#' - 1 $(echo "$count/10" | bc) | xargs | tr -d ' '`
    fi
    echo $rev $count $graph
  done

  git checkout -q master
}

main
